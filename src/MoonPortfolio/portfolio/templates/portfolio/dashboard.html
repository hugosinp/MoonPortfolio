{% extends 'home/base_logged.html' %}
{% load static %}
{% load humanize %}
{% load mathfilters %}

{% block title %}
MoonPortfolio | Dashboard
{% endblock %}

{% block styles %}
{% endblock %}

{% block body %}

<div class="container-flex m-5">

  <div class="row m-5">

    <!-- ___________________________________________ROW 1___________________________________________-->
    <div class="row mb-5">
      <h1>Your Portfolios</h1>

      <table class="table table-hover"cellspacing="0" width="100%">
        <thead>
            <tr>
                <th scope='col'>Name</th>
            </tr>
        </thead>
        <tbody>
        {% for portfolio in portfolios %}
          <tr>  
              <td class='align-middle'>
                <a class="btn btn-primary btn-lg" href="{% url 'dashboard' portfolio.id %}">{{ portfolio.name }}</a>
                <a class="btn btn-danger btn-lg" href="{% url 'delete_portfolio' portfolio.id %}">‚ùå</a>
              </td>
          </tr>
        {% endfor %}
        </tbody>
      </table>


      <!-- Button trigger modal -->
      <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#createPortfolioModal">
        <img src="{% static 'img/plus.svg' %}" alt="" width="15" height="15" class="m-1 align-text-center"> Add a Portfolio !
      </button>


    </div>
    <!-- ___________________________________________END ROW 1___________________________________________-->
    <!-- ___________________________________________ROW 2___________________________________________-->
    <div class="row">
      <table class="table table-hover table-bordered table-dark" id="coins" cellspacing="0" width="100%">
        <thead>
            <tr>
                <th scope='col'>#</th>
                <th scope='col'>Name</th>
                <th scope='col'>Price / 24h Change</th>
                <th scope='col'>Market Cap</th>
            </tr>
        </thead>
        <tbody>
          {% if coin_api %}
            {% for coin in coin_api %}
                <tr>
                    <td class='align-middle'>{{ coin.market_cap_rank }}</td>
                    <td class='align-middle'>
                        <a style="text-decoration: none; color: white;" href="asset/{{ coin.symbol }}" target="_blank">
                            <img src={{ coin.image }} height='40' style="padding-right: 3%;">
                            <span class="fw-bold">{{ coin.name }}</span> 
                            <span class="badge bg-dark text-uppercase text-light">{{ coin.symbol }}</span> 
                        </a>
                    </td>
                    <td class='align-middle'>
                        {{ coin.current_price|intcomma }} $USD 
                        {% if coin.price_change_percentage_24h >= 0 %}
                            <span class="text-success" style="color=green;">(+{{ coin.price_change_percentage_24h|floatformat:"2" }}%)</span>
                            <img src="{% static 'img/up.png' %}" alt="" width="15" height="15"> 
                        {% elif coin.price_change_percentage_24h < 0 %}
                            <span class="text-danger">({{ coin.price_change_percentage_24h|floatformat:"2" }}%)</span>
                            <img src="{% static 'img/down.png' %}" alt="" width="15" height="15"> 
                        {% endif %}
                    </td>
                    <td class='align-middle'>{{ coin.market_cap|intcomma }} $USD</td>
                </tr>
            {% endfor %}
          {% else %}
              <h3>No data from CoinGecko</h3>
          {% endif %}

        </tbody>
      </table>
    </div>
    <!-- ___________________________________________END ROW 2___________________________________________-->

  </div>

  <!-- Modal -->
  <div class="modal fade" id="createPortfolioModal" tabindex="-1" aria-labelledby="createPortfolioModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="createPortfolioModalLabel">Choose a name for your Portfolio</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body text-center">
          <form action="" method="POST">
            {% csrf_token %}
            {{ portfolio_form.as_p }}                    
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
          <input type="submit" class="btn btn-primary" value="Save">
          </form>
        </div>
      </div>
    </div>
  </div>

</div>

<script>
    $(document).ready(function () {
        $('#coins').DataTable();
        $('.dataTables_length').addClass('bs-select');
    });
</script>
{% endblock %}